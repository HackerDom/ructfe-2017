function Shape(a,i,b,d,f,e,c,g){this.x=a||0;this.y=i||0;this.w=b||0;this.h=d||0;this.text=f;this.fill=e||"#AAAAAA";this.font=c||"30px Arial";this.selected=false;this.clickHandler=g}Shape.prototype.draw=function(a){a.font=this.font;a.fillStyle=this.selected?"red":this.fill;if(this.text){enableShadow(a);a.fillText(this.text,this.x,this.y+this.h);disableShadow(a)}else{a.fillRect(this.x,this.y,this.w,this.h)}};Shape.prototype.contains=function(b,a){return(this.x<=b)&&(this.x+this.w>=b)&&(this.y<=a)&&(this.y+this.h>=a)};function CanvasState(c){this.canvas=c;this.width=c.width;this.height=c.height;this.ctx=c.getContext("2d");var a,f,g,b;if(document.defaultView&&document.defaultView.getComputedStyle){this.stylePaddingLeft=parseInt(document.defaultView.getComputedStyle(c,null)["paddingLeft"],10)||0;this.stylePaddingTop=parseInt(document.defaultView.getComputedStyle(c,null)["paddingTop"],10)||0;this.styleBorderLeft=parseInt(document.defaultView.getComputedStyle(c,null)["borderLeftWidth"],10)||0;this.styleBorderTop=parseInt(document.defaultView.getComputedStyle(c,null)["borderTopWidth"],10)||0}var e=document.body.parentNode;this.htmlTop=e.offsetTop;this.htmlLeft=e.offsetLeft;this.valid=false;this.dlgstate="idle";this.shapes=[];this.input="";var d=this;c.addEventListener("selectstart",function(h){h.preventDefault();return false},false);c.addEventListener("click",function(o){var k=d.getMouse(o);var p=k.x;var n=k.y;var j=d.shapes;var h=j.length;for(var m=h-1;m>=0;m--){if(j[m].contains(p,n)){if(j[m].clickHandler){j[m].clickHandler(d,j[m])}return}}},true);window.addEventListener("keypress",function(h){if(d.dlgstate!="save"){return}if(h.keyCode==13){doSave(d)}else{if(d.input.length<10){d.input+=String.fromCharCode(h.keyCode).toUpperCase()}}},true);window.addEventListener("keydown",function(h){if(d.dlgstate!="save"){return}if(h.keyCode==8||h.keyCode==46){if(d.input){d.input=d.input.substr(0,d.input.length-1)}}else{if(h.keyCode==127){d.dlgstate=""}}d.valid=false},true);this.interval=30;setInterval(function(){d.draw()},d.interval)}CanvasState.prototype.addShape=function(a){this.shapes.push(a);this.valid=false};CanvasState.prototype.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)};CanvasState.prototype.draw=function(){if(!this.valid){var c=this.ctx;var b=this.shapes;this.clear();drawGlass(this,c);var a=b.length;for(var d=0;d<a;d++){b[d].draw(c)}this.valid=true}};function drawLowerEllipseRtl(b,e,d,c,a){b.moveTo(e+c/2,d);b.bezierCurveTo(e+c/2,d+a/2,e-c/2,d+a/2,e-c/2,d)}function drawLowerEllipse(b,e,d,c,a){b.moveTo(e-c/2,d);b.bezierCurveTo(e-c/2,d+a/2,e+c/2,d+a/2,e+c/2,d)}function drawUpperEllipse(b,e,d,c,a){b.moveTo(e-c/2,d);b.bezierCurveTo(e-c/2,d-a/2,e+c/2,d-a/2,e+c/2,d)}function drawGlass(b,a){a.beginPath();drawUpperEllipse(a,b.width/2,b.height-350,225,50);a.lineTo(b.width/2+150/2,b.height-50);drawLowerEllipseRtl(a,b.width/2,b.height-50,150,50);a.lineTo(b.width/2-225/2,b.height-350);a.fillStyle="rgba(250, 250, 250, 0.05)";a.fill();a.strokeStyle="rgba(250, 250, 250, 0.2)";a.lineWidth=2;a.stroke();a.beginPath();drawLowerEllipseRtl(a,b.width/2,b.height-350,225,50);a.lineTo(b.width/2-150/2,b.height-50);drawUpperEllipse(a,b.width/2,b.height-50,150,50);a.lineTo(b.width/2+225/2,b.height-350);a.strokeStyle="rgba(250, 250, 250, 0.2)";a.lineWidth=2;a.stroke();a.beginPath();drawLowerEllipse(a,b.width/2,b.height-350,225,50);a.lineTo(b.width/2-150/2,b.height-50);drawLowerEllipseRtl(a,b.width/2,b.height-50,150,50);a.lineTo(b.width/2+225/2,b.height-350);a.fillStyle="rgba(250, 250, 250, 0.15)";a.fill()}CanvasState.prototype.getMouse=function(d){var b=this.canvas,a=0,g=0,f,c;if(b.offsetParent!==undefined){do{a+=b.offsetLeft;g+=b.offsetTop}while((b=b.offsetParent))}a+=this.stylePaddingLeft+this.styleBorderLeft+this.htmlLeft;g+=this.stylePaddingTop+this.styleBorderTop+this.htmlTop;f=d.pageX-a;c=d.pageY-g;return{x:f,y:c}};function loadData(a,b){var c=new XMLHttpRequest();c.onreadystatechange=function(){if(this.readyState==4){b(this.status,this.responseText)}};c.open("GET",a,true);c.send()}function makeColor(f,b,e){e=e||0;return"rgba("+Math.max(0,parseInt(f.substr(0,2),16)-e)+","+Math.max(0,parseInt(f.substr(2,2),16)-e)+","+Math.max(0,parseInt(f.substr(4,2),16)-e)+","+b+")"}function addLiquid(f,e){var b=parseInt(e.substr(14,2),16)/255;var a=parseInt(e.substr(12,2),16)/255;var d=e.substr(0,6);var c=e.substr(6,6);var g={};g.contains=function(){};g.draw=function(i){var h=i.createLinearGradient(f.width/2,f.height-280,f.width/2,f.height-50);h.addColorStop(0,makeColor(d,b*0.8));h.addColorStop(1,makeColor(c,a*0.8));i.beginPath();drawUpperEllipse(i,f.width/2,f.height-280,205,50);i.lineTo(f.width/2+150/2,f.height-50);drawLowerEllipseRtl(i,parseInt(f.width/2),f.height-50,150,50);i.lineTo(f.width/2-205/2,f.height-280);i.fillStyle=h;i.fill();i.beginPath();drawUpperEllipse(i,parseInt(f.width/2),f.height-280,205,50);drawLowerEllipseRtl(i,parseInt(f.width/2),f.height-280,205,50);i.fillStyle=makeColor(d,b*0.8);i.fill();i.strokeStyle=makeColor(d,b,20);i.beginPath();drawUpperEllipse(i,parseInt(f.width/2),f.height-280,205,50);i.lineWidth=1;i.stroke();i.beginPath();drawLowerEllipseRtl(i,parseInt(f.width/2),f.height-280,205,50);i.lineWidth=2;i.stroke()};f.shapes=[g].concat(f.shapes)}function doMixNew(c){var d=[];for(var a=0;a<c.shapes.length;a++){if(c.shapes[a].selected){d.push(c.shapes[a].text);d.push(c.shapes[a].text);d.push(c.shapes[a].text)}}c.recipe=d.join(",");var b="mixnew?what="+c.recipe;loadData(b,function(e,f){if(e!=200){alert(e)}addLiquid(c,f);c.dlgstate="save";c.valid=false})}function doMix(d){var a="";for(var b=0;b<d.shapes.length;b++){if(d.shapes[b].selected){a=d.shapes[b].text}}var c="mix?name="+a;loadData(c,function(e,f){if(e!=200){alert(e)}addLiquid(d,f);d.dlgstate="";d.valid=false})}function doSave(b){var a="memorize?name="+b.input+"&what="+b.recipe;loadData(a,function(c,d){if(c!=201){alert(c)}else{alert("Done! Your recipe is called "+d)}b.dlgstate="";b.valid=false})}function enableShadow(a){a.shadowColor="black";a.shadowOffsetX=2;a.shadowOffsetY=2;a.shadowBlur=5}function disableShadow(a){a.shadowColor="rgba(0,0,0,0)";a.shadowOffsetX=0;a.shadowOffsetY=0;a.shadowBlur=0}spirits=["Ale","Porter","Stout","Lager","Cider","Mead","Wine","Port","Sherry","Vermouth","Vinsanto","Sangria","Champagne","Sake","Brandy","Cognac","Armagnac","Schnapps","Gin","Horilka","Metaxa","Rakia","Rum","Shochu","Soju","Tequila","Vodka","Bourbon","Whiskey","Absinthe","Juice","Cola","Water"];function init(){var j=new CanvasState(document.getElementById("canvas1"));var b="rgba(250,250,250,0.9)";var h="rgba(0,0,0,0.4)";var d=function(n,l){if(n.dlgstate=="idle"||n.dlgstate=="mixsel"){l.selected^=1;var k=0;for(var m=0;m<n.shapes.length;m++){k+=n.shapes[m].selected?1:0}n.dlgstate=k?"mixsel":"idle";n.valid=false}};var a=function(k,i){if(k.dlgstate=="idle"){i.selected=true;k.dlgstate="mix";doMix(k)}};j.addShape(new Shape(80,20,380,650,null,h));j.addShape(new Shape(j.width-450,20,380,650,null,h));loadData("list?skip=0&take=10",function(l,n){if(l!=200){return}var k=n.split("\n");for(var m=0;m<k.length;m++){if(k[m]==""){continue}j.addShape(new Shape(j.width-400,100+30*m,150,20,k[m],b,"20px Arial",a))}});for(var e=0;e<parseInt(spirits.length/2);e++){j.addShape(new Shape(150,100+30*e,150,20,spirits[e],b,"20px Arial",d))}for(var e=parseInt(spirits.length/2);e<spirits.length;e++){j.addShape(new Shape(310,100+30*(e-parseInt(spirits.length/2)),150,20,spirits[e],b,"20px Arial",d))}j.addShape(new Shape(180,50,150,30,"Mix yourself",b,"35px Arial"));j.addShape(new Shape(j.width-350,50,150,30,"Order existing",b,"35px Arial"));var c=new Shape(200,600,180,60,"Mix this",b,"40px Arial",function(k,i){if(k.dlgstate=="mixsel"){k.dlgstate="mixnew";doMixNew(k)}});c.draw=function(i){if(j.dlgstate!="mixsel"){return}enableShadow(i);i.fillStyle="rgba(140, 30, 30, 0.9)";i.fillRect(this.x-20,this.y+15,this.w,this.h);i.font=this.font;i.fillStyle=this.fill;i.fillText(this.text,this.x,this.y+this.h);disableShadow(i)};j.addShape(c);var g=new Shape(parseInt(j.width/2-150)-20,500,400,130,"How should we call it?",b,"20px Arial");g.draw=function(i){if(j.dlgstate!="save"){return}enableShadow(i);i.fillStyle="rgba(140, 30, 30, 1)";i.fillRect(this.x-20,this.y+15,this.w,this.h);i.font=this.font;i.fillStyle=this.fill;i.fillText(this.text,this.x,this.y+50);disableShadow(i)};j.addShape(g);var f=new Shape(parseInt(j.width/2-150),550,360,60,"","black","40px Arial");f.draw=function(i){if(j.dlgstate!="save"){return}i.fillStyle="rgba(250, 250, 250, 1)";i.fillRect(this.x-20,this.y+15,this.w,this.h);i.font=this.font;i.fillStyle=this.fill;i.fillText(j.input,this.x,this.y+this.h)};j.addShape(f)}(function(){var b=document.getElementById("canvas1");window.addEventListener("resize",a,false);function a(){b.width=window.innerWidth;b.height=window.innerHeight;init()}a()})();